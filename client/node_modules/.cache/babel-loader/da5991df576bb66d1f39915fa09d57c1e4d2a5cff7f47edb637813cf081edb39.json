{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/user/Desktop/SimplyEx/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/user/Desktop/SimplyEx/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import{useNavigate}from\"react-router-dom\";import{serveUrl}from\"../../../../../../../config\";import{useAppDispatch,useAppSelector}from\"../../../../../../../store/hooks\";import{dispatchCaptchaIsValid,dispatchIsValidReceiver,dispatchOrder,generateCaptcha}from\"../../../../../../../store/slices/exchange\";var useForm=function useForm(){var _useAppSelector=useAppSelector(function(state){return state.exchange;}),captcha=_useAppSelector.captcha,email=_useAppSelector.email,receiver=_useAppSelector.receiver,fromCurrency=_useAppSelector.fromCurrency,toCurrency=_useAppSelector.toCurrency;var dispatch=useAppDispatch();var navigate=useNavigate();var validateCaptcha=function validateCaptcha(){if(Number(captcha.num1)+Number(captcha.num2)===Number(captcha.result)){dispatch(dispatchCaptchaIsValid(true));return true;}dispatch(dispatchCaptchaIsValid(false));dispatch(generateCaptcha());return false;};var validateReceiver=function validateReceiver(){var regex=/^(0x){1}[0-9a-fA-F]{40}$/i;if(regex.test(receiver)){dispatch(dispatchIsValidReceiver(true));return true;}dispatch(dispatchIsValidReceiver(false));return false;};var sendForm=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e,sendAmount,receiveAmount){var isValidCaptcha,isValidReceiver,referalCode,res,order;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;e.preventDefault();isValidCaptcha=validateCaptcha();isValidReceiver=validateReceiver();if(!(!isValidCaptcha||!isValidReceiver)){_context.next=6;break;}return _context.abrupt(\"return\",null);case 6:referalCode=localStorage.getItem('ref');_context.next=9;return fetch(\"\".concat(serveUrl,\"/newOrder/\").concat(receiveAmount,\"/\").concat(toCurrency.shortName,\"/\").concat(sendAmount,\"/\").concat(fromCurrency.shortName,\"/\").concat(receiver,\"/\").concat(email,\"/\").concat(referalCode||'null',\"/pending\"),{method:'POST'}).then(function(res){return res.json();});case 9:res=_context.sent;if(!res.orderId){_context.next=18;break;}_context.next=13;return fetch(\"\".concat(serveUrl,\"/order/\").concat(res.orderId)).then(function(res){return res.json();});case 13:order=_context.sent;dispatch(dispatchOrder(order));navigate(\"/order/\".concat(res.orderId));_context.next=19;break;case 18:throw new Error('something went wrong with order id');case 19:_context.next=24;break;case 21:_context.prev=21;_context.t0=_context[\"catch\"](0);console.error(_context.t0.message);case 24:case\"end\":return _context.stop();}},_callee,null,[[0,21]]);}));return function sendForm(_x,_x2,_x3){return _ref.apply(this,arguments);};}();return{sendForm:sendForm};};export default useForm;","map":{"version":3,"names":["useNavigate","serveUrl","useAppDispatch","useAppSelector","dispatchCaptchaIsValid","dispatchIsValidReceiver","dispatchOrder","generateCaptcha","useForm","state","exchange","captcha","email","receiver","fromCurrency","toCurrency","dispatch","navigate","validateCaptcha","Number","num1","num2","result","validateReceiver","regex","test","sendForm","e","sendAmount","receiveAmount","preventDefault","isValidCaptcha","isValidReceiver","referalCode","localStorage","getItem","fetch","shortName","method","then","res","json","orderId","order","Error","console","error","message"],"sources":["C:/Users/user/Desktop/SimplyEx/client/src/screens/home/components/exchange/components/form/hooks/useForm.ts"],"sourcesContent":["import { useNavigate } from \"react-router-dom\"\r\nimport { serveUrl } from \"../../../../../../../config\"\r\nimport { useAppDispatch, useAppSelector } from \"../../../../../../../store/hooks\"\r\nimport { dispatchCaptchaIsValid, dispatchIsValidReceiver, dispatchOrder, generateCaptcha } from \"../../../../../../../store/slices/exchange\"\r\n\r\nconst useForm = () => {\r\n    const {\r\n        captcha,\r\n        email,\r\n        receiver,\r\n        fromCurrency,\r\n        toCurrency\r\n    } = useAppSelector(state => state.exchange)\r\n\r\n    const dispatch = useAppDispatch()\r\n    const navigate = useNavigate()\r\n\r\n    const validateCaptcha = () => {\r\n        if (Number(captcha.num1) + Number(captcha.num2) === Number(captcha.result)) {\r\n            dispatch(dispatchCaptchaIsValid(true))\r\n            return true\r\n        }\r\n\r\n        dispatch(dispatchCaptchaIsValid(false))\r\n        dispatch(generateCaptcha())\r\n        return false\r\n    }\r\n\r\n    const validateReceiver = () => {\r\n        const regex = /^(0x){1}[0-9a-fA-F]{40}$/i\r\n\r\n        if (regex.test(receiver)) {\r\n            dispatch(dispatchIsValidReceiver(true))\r\n            return true\r\n        }\r\n\r\n        dispatch(dispatchIsValidReceiver(false))\r\n        return false\r\n    }\r\n\r\n    const sendForm = async (e: React.FormEvent<HTMLFormElement>, sendAmount: string, receiveAmount: string) => {\r\n        try {\r\n            e.preventDefault()\r\n\r\n            const isValidCaptcha = validateCaptcha()\r\n            const isValidReceiver = validateReceiver()\r\n\r\n            if (!isValidCaptcha || !isValidReceiver) return null\r\n\r\n            const referalCode = localStorage.getItem('ref')\r\n\r\n            const res = await fetch(`${serveUrl}/newOrder/${receiveAmount}/${toCurrency.shortName}/${sendAmount}/${fromCurrency.shortName}/${receiver}/${email}/${referalCode || 'null'}/pending`, {\r\n                method: 'POST'\r\n            }).then(res => res.json())\r\n\r\n            if (res.orderId) {\r\n                const order = await fetch(`${serveUrl}/order/${res.orderId}`).then(res => res.json())\r\n\r\n                dispatch(dispatchOrder(order))\r\n\r\n                navigate(`/order/${res.orderId}`)\r\n            } else {\r\n                throw new Error('something went wrong with order id')\r\n            }\r\n        } catch (error: any) {\r\n            console.error(error.message)\r\n        }\r\n    }\r\n\r\n    return {\r\n        sendForm\r\n    }\r\n}\r\n\r\nexport default useForm"],"mappings":"sQAAA,OAASA,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,QAAQ,KAAQ,6BAA6B,CACtD,OAASC,cAAc,CAAEC,cAAc,KAAQ,kCAAkC,CACjF,OAASC,sBAAsB,CAAEC,uBAAuB,CAAEC,aAAa,CAAEC,eAAe,KAAQ,4CAA4C,CAE5I,GAAMC,QAAO,CAAG,QAAVA,QAAO,EAAS,CAClB,oBAMIL,cAAc,CAAC,SAAAM,KAAK,QAAIA,MAAK,CAACC,QAAQ,GAAC,CALvCC,OAAO,iBAAPA,OAAO,CACPC,KAAK,iBAALA,KAAK,CACLC,QAAQ,iBAARA,QAAQ,CACRC,YAAY,iBAAZA,YAAY,CACZC,UAAU,iBAAVA,UAAU,CAGd,GAAMC,SAAQ,CAAGd,cAAc,EAAE,CACjC,GAAMe,SAAQ,CAAGjB,WAAW,EAAE,CAE9B,GAAMkB,gBAAe,CAAG,QAAlBA,gBAAe,EAAS,CAC1B,GAAIC,MAAM,CAACR,OAAO,CAACS,IAAI,CAAC,CAAGD,MAAM,CAACR,OAAO,CAACU,IAAI,CAAC,GAAKF,MAAM,CAACR,OAAO,CAACW,MAAM,CAAC,CAAE,CACxEN,QAAQ,CAACZ,sBAAsB,CAAC,IAAI,CAAC,CAAC,CACtC,MAAO,KAAI,CACf,CAEAY,QAAQ,CAACZ,sBAAsB,CAAC,KAAK,CAAC,CAAC,CACvCY,QAAQ,CAACT,eAAe,EAAE,CAAC,CAC3B,MAAO,MAAK,CAChB,CAAC,CAED,GAAMgB,iBAAgB,CAAG,QAAnBA,iBAAgB,EAAS,CAC3B,GAAMC,MAAK,CAAG,2BAA2B,CAEzC,GAAIA,KAAK,CAACC,IAAI,CAACZ,QAAQ,CAAC,CAAE,CACtBG,QAAQ,CAACX,uBAAuB,CAAC,IAAI,CAAC,CAAC,CACvC,MAAO,KAAI,CACf,CAEAW,QAAQ,CAACX,uBAAuB,CAAC,KAAK,CAAC,CAAC,CACxC,MAAO,MAAK,CAChB,CAAC,CAED,GAAMqB,SAAQ,4FAAG,iBAAOC,CAAmC,CAAEC,UAAkB,CAAEC,aAAqB,4LAE9FF,CAAC,CAACG,cAAc,EAAE,CAEZC,cAAc,CAAGb,eAAe,EAAE,CAClCc,eAAe,CAAGT,gBAAgB,EAAE,MAEtC,CAACQ,cAAc,EAAI,CAACC,eAAe,0DAAS,IAAI,SAE9CC,WAAW,CAAGC,YAAY,CAACC,OAAO,CAAC,KAAK,CAAC,uBAE7BC,MAAK,WAAInC,QAAQ,sBAAa4B,aAAa,aAAId,UAAU,CAACsB,SAAS,aAAIT,UAAU,aAAId,YAAY,CAACuB,SAAS,aAAIxB,QAAQ,aAAID,KAAK,aAAIqB,WAAW,EAAI,MAAM,aAAY,CACnLK,MAAM,CAAE,MACZ,CAAC,CAAC,CAACC,IAAI,CAAC,SAAAC,GAAG,QAAIA,IAAG,CAACC,IAAI,EAAE,GAAC,QAFpBD,GAAG,mBAILA,GAAG,CAACE,OAAO,iDACSN,MAAK,WAAInC,QAAQ,mBAAUuC,GAAG,CAACE,OAAO,EAAG,CAACH,IAAI,CAAC,SAAAC,GAAG,QAAIA,IAAG,CAACC,IAAI,EAAE,GAAC,SAA/EE,KAAK,eAEX3B,QAAQ,CAACV,aAAa,CAACqC,KAAK,CAAC,CAAC,CAE9B1B,QAAQ,kBAAWuB,GAAG,CAACE,OAAO,EAAG,qCAE3B,IAAIE,MAAK,CAAC,oCAAoC,CAAC,0FAGzDC,OAAO,CAACC,KAAK,CAAC,YAAMC,OAAO,CAAC,qEAEnC,kBA3BKrB,SAAQ,oDA2Bb,CAED,MAAO,CACHA,QAAQ,CAARA,QACJ,CAAC,CACL,CAAC,CAED,cAAelB,QAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}