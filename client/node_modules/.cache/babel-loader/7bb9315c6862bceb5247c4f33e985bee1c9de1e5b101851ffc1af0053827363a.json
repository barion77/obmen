{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useNavigate } from \"react-router-dom\";\nimport { serveUrl } from \"../../../../../../../config\";\nimport { useAppDispatch, useAppSelector } from \"../../../../../../../store/hooks\";\nimport { dispatchCaptchaIsValid, dispatchIsValidReceiver, dispatchOrder, generateCaptcha } from \"../../../../../../../store/slices/exchange\";\nconst useForm = () => {\n  _s();\n  const {\n    captcha,\n    email,\n    receiver,\n    fromCurrency,\n    toCurrency\n  } = useAppSelector(state => state.exchange);\n  const dispatch = useAppDispatch();\n  const navigate = useNavigate();\n  const validateCaptcha = () => {\n    if (Number(captcha.num1) + Number(captcha.num2) === Number(captcha.result)) {\n      dispatch(dispatchCaptchaIsValid(true));\n      return true;\n    }\n    dispatch(dispatchCaptchaIsValid(false));\n    dispatch(generateCaptcha());\n    return false;\n  };\n  const validateReceiver = () => {\n    const regex = /^(0x){1}[0-9a-fA-F]{40}$/i;\n    if (regex.test(receiver)) {\n      dispatch(dispatchIsValidReceiver(true));\n      return true;\n    }\n    dispatch(dispatchIsValidReceiver(false));\n    return false;\n  };\n  const sendForm = async (e, sendAmount, receiveAmount) => {\n    try {\n      e.preventDefault();\n      const isValidCaptcha = validateCaptcha();\n      const isValidReceiver = validateReceiver();\n      if (!isValidCaptcha || !isValidReceiver) return null;\n      const referalCode = localStorage.getItem('ref');\n      const res = await fetch(`${serveUrl}/newOrder/${receiveAmount}/${toCurrency.shortName}/${sendAmount}/${fromCurrency.shortName}/${receiver}/${email}/${referalCode || 'null'}/pending`, {\n        method: 'POST'\n      }).then(res => res.json());\n      if (res.orderId) {\n        const order = await fetch(`${serveUrl}/order/${res.orderId}`).then(res => res.json());\n        dispatch(dispatchOrder(order));\n        navigate(`/order/${res.orderId}`);\n      } else {\n        throw new Error('something went wrong with order id');\n      }\n    } catch (error) {\n      console.error(error.message);\n    }\n  };\n  return {\n    sendForm\n  };\n};\n_s(useForm, \"nu0XBY/XUBD2YTQmYCD5febJI0E=\", false, function () {\n  return [useAppSelector, useAppDispatch, useNavigate];\n});\nexport default useForm;","map":{"version":3,"names":["useNavigate","serveUrl","useAppDispatch","useAppSelector","dispatchCaptchaIsValid","dispatchIsValidReceiver","dispatchOrder","generateCaptcha","useForm","captcha","email","receiver","fromCurrency","toCurrency","state","exchange","dispatch","navigate","validateCaptcha","Number","num1","num2","result","validateReceiver","regex","test","sendForm","e","sendAmount","receiveAmount","preventDefault","isValidCaptcha","isValidReceiver","referalCode","localStorage","getItem","res","fetch","shortName","method","then","json","orderId","order","Error","error","console","message"],"sources":["/Users/levanta1s/Desktop/dev/Worker's Club/exchange_front/src/screens/home/components/exchange/components/form/hooks/useForm.ts"],"sourcesContent":["import { useNavigate } from \"react-router-dom\"\r\nimport { serveUrl } from \"../../../../../../../config\"\r\nimport { useAppDispatch, useAppSelector } from \"../../../../../../../store/hooks\"\r\nimport { dispatchCaptchaIsValid, dispatchIsValidReceiver, dispatchOrder, generateCaptcha } from \"../../../../../../../store/slices/exchange\"\r\n\r\nconst useForm = () => {\r\n    const {\r\n        captcha,\r\n        email,\r\n        receiver,\r\n        fromCurrency,\r\n        toCurrency\r\n    } = useAppSelector(state => state.exchange)\r\n\r\n    const dispatch = useAppDispatch()\r\n    const navigate = useNavigate()\r\n\r\n    const validateCaptcha = () => {\r\n        if (Number(captcha.num1) + Number(captcha.num2) === Number(captcha.result)) {\r\n            dispatch(dispatchCaptchaIsValid(true))\r\n            return true\r\n        }\r\n\r\n        dispatch(dispatchCaptchaIsValid(false))\r\n        dispatch(generateCaptcha())\r\n        return false\r\n    }\r\n\r\n    const validateReceiver = () => {\r\n        const regex = /^(0x){1}[0-9a-fA-F]{40}$/i\r\n\r\n        if (regex.test(receiver)) {\r\n            dispatch(dispatchIsValidReceiver(true))\r\n            return true\r\n        }\r\n\r\n        dispatch(dispatchIsValidReceiver(false))\r\n        return false\r\n    }\r\n\r\n    const sendForm = async (e: React.FormEvent<HTMLFormElement>, sendAmount: string, receiveAmount: string) => {\r\n        try {\r\n            e.preventDefault()\r\n\r\n            const isValidCaptcha = validateCaptcha()\r\n            const isValidReceiver = validateReceiver()\r\n\r\n            if (!isValidCaptcha || !isValidReceiver) return null\r\n\r\n            const referalCode = localStorage.getItem('ref')\r\n\r\n            const res = await fetch(`${serveUrl}/newOrder/${receiveAmount}/${toCurrency.shortName}/${sendAmount}/${fromCurrency.shortName}/${receiver}/${email}/${referalCode || 'null'}/pending`, {\r\n                method: 'POST'\r\n            }).then(res => res.json())\r\n\r\n            if (res.orderId) {\r\n                const order = await fetch(`${serveUrl}/order/${res.orderId}`).then(res => res.json())\r\n\r\n                dispatch(dispatchOrder(order))\r\n\r\n                navigate(`/order/${res.orderId}`)\r\n            } else {\r\n                throw new Error('something went wrong with order id')\r\n            }\r\n        } catch (error: any) {\r\n            console.error(error.message)\r\n        }\r\n    }\r\n\r\n    return {\r\n        sendForm\r\n    }\r\n}\r\n\r\nexport default useForm"],"mappings":";AAAA,SAASA,WAAW,QAAQ,kBAAkB;AAC9C,SAASC,QAAQ,QAAQ,6BAA6B;AACtD,SAASC,cAAc,EAAEC,cAAc,QAAQ,kCAAkC;AACjF,SAASC,sBAAsB,EAAEC,uBAAuB,EAAEC,aAAa,EAAEC,eAAe,QAAQ,4CAA4C;AAE5I,MAAMC,OAAO,GAAG,MAAM;EAAA;EAClB,MAAM;IACFC,OAAO;IACPC,KAAK;IACLC,QAAQ;IACRC,YAAY;IACZC;EACJ,CAAC,GAAGV,cAAc,CAACW,KAAK,IAAIA,KAAK,CAACC,QAAQ,CAAC;EAE3C,MAAMC,QAAQ,GAAGd,cAAc,EAAE;EACjC,MAAMe,QAAQ,GAAGjB,WAAW,EAAE;EAE9B,MAAMkB,eAAe,GAAG,MAAM;IAC1B,IAAIC,MAAM,CAACV,OAAO,CAACW,IAAI,CAAC,GAAGD,MAAM,CAACV,OAAO,CAACY,IAAI,CAAC,KAAKF,MAAM,CAACV,OAAO,CAACa,MAAM,CAAC,EAAE;MACxEN,QAAQ,CAACZ,sBAAsB,CAAC,IAAI,CAAC,CAAC;MACtC,OAAO,IAAI;IACf;IAEAY,QAAQ,CAACZ,sBAAsB,CAAC,KAAK,CAAC,CAAC;IACvCY,QAAQ,CAACT,eAAe,EAAE,CAAC;IAC3B,OAAO,KAAK;EAChB,CAAC;EAED,MAAMgB,gBAAgB,GAAG,MAAM;IAC3B,MAAMC,KAAK,GAAG,2BAA2B;IAEzC,IAAIA,KAAK,CAACC,IAAI,CAACd,QAAQ,CAAC,EAAE;MACtBK,QAAQ,CAACX,uBAAuB,CAAC,IAAI,CAAC,CAAC;MACvC,OAAO,IAAI;IACf;IAEAW,QAAQ,CAACX,uBAAuB,CAAC,KAAK,CAAC,CAAC;IACxC,OAAO,KAAK;EAChB,CAAC;EAED,MAAMqB,QAAQ,GAAG,OAAOC,CAAmC,EAAEC,UAAkB,EAAEC,aAAqB,KAAK;IACvG,IAAI;MACAF,CAAC,CAACG,cAAc,EAAE;MAElB,MAAMC,cAAc,GAAGb,eAAe,EAAE;MACxC,MAAMc,eAAe,GAAGT,gBAAgB,EAAE;MAE1C,IAAI,CAACQ,cAAc,IAAI,CAACC,eAAe,EAAE,OAAO,IAAI;MAEpD,MAAMC,WAAW,GAAGC,YAAY,CAACC,OAAO,CAAC,KAAK,CAAC;MAE/C,MAAMC,GAAG,GAAG,MAAMC,KAAK,CAAE,GAAEpC,QAAS,aAAY4B,aAAc,IAAGhB,UAAU,CAACyB,SAAU,IAAGV,UAAW,IAAGhB,YAAY,CAAC0B,SAAU,IAAG3B,QAAS,IAAGD,KAAM,IAAGuB,WAAW,IAAI,MAAO,UAAS,EAAE;QACnLM,MAAM,EAAE;MACZ,CAAC,CAAC,CAACC,IAAI,CAACJ,GAAG,IAAIA,GAAG,CAACK,IAAI,EAAE,CAAC;MAE1B,IAAIL,GAAG,CAACM,OAAO,EAAE;QACb,MAAMC,KAAK,GAAG,MAAMN,KAAK,CAAE,GAAEpC,QAAS,UAASmC,GAAG,CAACM,OAAQ,EAAC,CAAC,CAACF,IAAI,CAACJ,GAAG,IAAIA,GAAG,CAACK,IAAI,EAAE,CAAC;QAErFzB,QAAQ,CAACV,aAAa,CAACqC,KAAK,CAAC,CAAC;QAE9B1B,QAAQ,CAAE,UAASmB,GAAG,CAACM,OAAQ,EAAC,CAAC;MACrC,CAAC,MAAM;QACH,MAAM,IAAIE,KAAK,CAAC,oCAAoC,CAAC;MACzD;IACJ,CAAC,CAAC,OAAOC,KAAU,EAAE;MACjBC,OAAO,CAACD,KAAK,CAACA,KAAK,CAACE,OAAO,CAAC;IAChC;EACJ,CAAC;EAED,OAAO;IACHrB;EACJ,CAAC;AACL,CAAC;AAAA,GAnEKlB,OAAO;EAAA,QAOLL,cAAc,EAEDD,cAAc,EACdF,WAAW;AAAA;AA2DhC,eAAeQ,OAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}