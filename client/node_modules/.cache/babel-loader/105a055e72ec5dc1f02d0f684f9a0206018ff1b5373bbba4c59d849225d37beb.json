{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/user/Desktop/SimplyEx/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/user/Desktop/SimplyEx/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/user/Desktop/SimplyEx/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import{useState,useEffect}from'react';import{serveUrl}from'../../config';var useChat=function useChat(){var _useState=useState([{id:1,text:'Hello my friend!',createdAt:'2021-07-21 12:09:12',user:{id:1}},{id:2,text:'Hello!',createdAt:'2021-07-21 14:09:12',user:{id:2}}]),_useState2=_slicedToArray(_useState,2),messages=_useState2[0],setMessages=_useState2[1];var getHistoy=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var userId,history;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:userId=localStorage.getItem('userId');_context.next=3;return fetch(\"\".concat(serveUrl,\"/msgHistory/\").concat(userId)).then(function(res){return res.json();});case 3:history=_context.sent;if(history.length>0){setMessages(history.map(function(elem){return{id:elem.id,text:elem.text,createdAt:elem.timestamp,user:{id:elem.user==='true'?2:1}};}));}case 5:case\"end\":return _context.stop();}},_callee);}));return function getHistoy(){return _ref.apply(this,arguments);};}();var sendMessage=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(message){var userId,timestamp;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:userId=localStorage.getItem('userId');timestamp=new Date().getTime();_context2.next=4;return fetch(\"\".concat(serveUrl,\"/msgSave/\").concat(message.text,\"/\").concat(userId,\"/\").concat(timestamp,\"/true\"),{method:'POST'});case 4:getHistoy();case 5:case\"end\":return _context2.stop();}},_callee2);}));return function sendMessage(_x){return _ref2.apply(this,arguments);};}();useEffect(function(){var timer=setInterval(function(){getHistoy();},5000);return function(){return clearInterval(timer);};});return{messages:messages,sendMessage:sendMessage};};export default useChat;","map":{"version":3,"names":["useState","useEffect","serveUrl","useChat","id","text","createdAt","user","messages","setMessages","getHistoy","userId","localStorage","getItem","fetch","then","res","json","history","length","map","elem","timestamp","sendMessage","message","Date","getTime","method","timer","setInterval","clearInterval"],"sources":["C:/Users/user/Desktop/SimplyEx/client/src/components/chat/useChat.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react'\r\nimport { Message } from 'react-simple-chat'\r\nimport { serveUrl } from '../../config'\r\nimport { useAppSelector } from '../../store/hooks'\r\n\r\nconst useChat = () => {\r\n    const [messages, setMessages] = useState<Message[]>([\r\n        {\r\n            id: 1,\r\n            text: 'Hello my friend!',\r\n            createdAt: '2021-07-21 12:09:12',\r\n            user: {\r\n                id: 1,\r\n            }\r\n        },\r\n        {\r\n            id: 2,\r\n            text: 'Hello!',\r\n            createdAt: '2021-07-21 14:09:12',\r\n            user: {\r\n                id: 2,\r\n            }\r\n        }\r\n    ])\r\n\r\n    const getHistoy = async () => {\r\n        const userId = localStorage.getItem('userId')\r\n\r\n        const history = await fetch(`${serveUrl}/msgHistory/${userId}`).then(res => res.json())\r\n\r\n        if (history.length > 0) {\r\n            setMessages(history.map((elem: any) => ({\r\n                id: elem.id,\r\n                text: elem.text,\r\n                createdAt: elem.timestamp,\r\n                user: {\r\n                    id: elem.user === 'true' ? 2 : 1\r\n                }\r\n            })))\r\n        }\r\n    }\r\n\r\n    const sendMessage = async (message: Message) => {\r\n        const userId = localStorage.getItem('userId')\r\n        const timestamp = new Date().getTime()\r\n        await fetch(`${serveUrl}/msgSave/${message.text}/${userId}/${timestamp}/true`, {\r\n            method: 'POST'\r\n        })\r\n\r\n        getHistoy()\r\n    }\r\n\r\n    useEffect(() => {\r\n        const timer = setInterval(() => {\r\n            getHistoy()\r\n        }, 5000)\r\n\r\n        return () => clearInterval(timer)\r\n    })\r\n\r\n    return {\r\n        messages,\r\n        sendMessage\r\n    }\r\n}\r\n\r\nexport default useChat"],"mappings":"iYAAA,OAASA,QAAQ,CAAEC,SAAS,KAAqB,OAAO,CAExD,OAASC,QAAQ,KAAQ,cAAc,CAGvC,GAAMC,QAAO,CAAG,QAAVA,QAAO,EAAS,CAClB,cAAgCH,QAAQ,CAAY,CAChD,CACII,EAAE,CAAE,CAAC,CACLC,IAAI,CAAE,kBAAkB,CACxBC,SAAS,CAAE,qBAAqB,CAChCC,IAAI,CAAE,CACFH,EAAE,CAAE,CACR,CACJ,CAAC,CACD,CACIA,EAAE,CAAE,CAAC,CACLC,IAAI,CAAE,QAAQ,CACdC,SAAS,CAAE,qBAAqB,CAChCC,IAAI,CAAE,CACFH,EAAE,CAAE,CACR,CACJ,CAAC,CACJ,CAAC,wCAjBKI,QAAQ,eAAEC,WAAW,eAmB5B,GAAMC,UAAS,4FAAG,uJACRC,MAAM,CAAGC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,uBAEvBC,MAAK,WAAIZ,QAAQ,wBAAeS,MAAM,EAAG,CAACI,IAAI,CAAC,SAAAC,GAAG,QAAIA,IAAG,CAACC,IAAI,EAAE,GAAC,QAAjFC,OAAO,eAEb,GAAIA,OAAO,CAACC,MAAM,CAAG,CAAC,CAAE,CACpBV,WAAW,CAACS,OAAO,CAACE,GAAG,CAAC,SAACC,IAAS,QAAM,CACpCjB,EAAE,CAAEiB,IAAI,CAACjB,EAAE,CACXC,IAAI,CAAEgB,IAAI,CAAChB,IAAI,CACfC,SAAS,CAAEe,IAAI,CAACC,SAAS,CACzBf,IAAI,CAAE,CACFH,EAAE,CAAEiB,IAAI,CAACd,IAAI,GAAK,MAAM,CAAG,CAAC,CAAG,CACnC,CACJ,CAAC,EAAC,CAAC,CAAC,CACR,CAAC,qDACJ,kBAfKG,UAAS,0CAed,CAED,GAAMa,YAAW,6FAAG,kBAAOC,OAAgB,4IACjCb,MAAM,CAAGC,YAAY,CAACC,OAAO,CAAC,QAAQ,CAAC,CACvCS,SAAS,CAAG,GAAIG,KAAI,EAAE,CAACC,OAAO,EAAE,wBAChCZ,MAAK,WAAIZ,QAAQ,qBAAYsB,OAAO,CAACnB,IAAI,aAAIM,MAAM,aAAIW,SAAS,UAAS,CAC3EK,MAAM,CAAE,MACZ,CAAC,CAAC,QAEFjB,SAAS,EAAE,wDACd,kBARKa,YAAW,6CAQhB,CAEDtB,SAAS,CAAC,UAAM,CACZ,GAAM2B,MAAK,CAAGC,WAAW,CAAC,UAAM,CAC5BnB,SAAS,EAAE,CACf,CAAC,CAAE,IAAI,CAAC,CAER,MAAO,kBAAMoB,cAAa,CAACF,KAAK,CAAC,GACrC,CAAC,CAAC,CAEF,MAAO,CACHpB,QAAQ,CAARA,QAAQ,CACRe,WAAW,CAAXA,WACJ,CAAC,CACL,CAAC,CAED,cAAepB,QAAO"},"metadata":{},"sourceType":"module","externalDependencies":[]}